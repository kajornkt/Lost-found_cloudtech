// sign up //
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lost&Found - Sign Up</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <link rel="stylesheet" href="register.css">
    <link rel="stylesheet" href="global.css">
</head>
<body>
    <div class="container-fluid d-flex flex-column flex-md-row min-vh-100 p-0 custom-gradient-bg">
        
        <div class="col-12 col-md-7 d-flex flex-column justify-content-between p-4 p-md-5 text-white custom-left-section">
            <h1 class="fw-bold mb-4 custom-brand-logo">Lost<a style="color: #2F455C;">&</a>Found</h1>
            <div class="mb-auto mt-auto text-center text-md-start">
                <h2 class="fw-bold custom-slogan">Lost it? Found it?<br>
                    Let's get it back<br>
                    to the right hands.</h2>
            </div>
            <div class="d-none d-md-block" style="height: 50px;"></div>
        </div>

        <div class="col-12 col-md-5 d-flex align-items-center justify-content-center p-4 p-md-5 custom-right-section">
            <div class="card p-4 p-md-5 custom-card">
                <h2 class="fw-bold mb-4 text-center text-md-start">Sign up</h2>
                <form>
                    <div class="mb-3">
                        <label for="nameInput" class="form-label">Name</label>
                        <input type="text" class="form-control custom-form-control" id="nameInput" placeholder="Name Surname">
                    </div>

                    <div class="row mb-3">
                        <div class="col-6">
                            <label for="facultySelect" class="form-label">Faculty</label>
                            <div class="select-wrapper">
                                <select class="form-select custom-form-control" id="facultySelect">
                                    <option selected>select</option>
                                    <option value="1">School of Engineering</option>
                                    <option value="2">School of Architecture, Art, and Design</option>
                                    <option value="3">School of Industrial Education and Technology</option>
                                    <option value="4">School of Agricultural Technology</option>
                                    <option value="5">School of Science</option>
                                    <option value="6">School of Food Industry</option>
                                    <option value="7">School of Information Technology</option>
                                    <option value="8">International College</option>
                                    <option value="9">College of Materials Innovation and Technology</option>
                                    <option value="10">College of Advanced Manufacturing Innovation</option>
                                    <option value="11">KMITL Business School</option>
                                    <option value="12">International Academy of Aviation Industry</option>
                                    <option value="13">School of Liberal Arts</option>
                                    <option value="14">Faculty of Medicine</option>
                                    <option value="15">College of Innovation and Industrial Management</option>
                                    <option value="16">Institute of Music Science and Engineering</option>
                                    <option value="17">School of Dentistry</option>
                                    <option value="18">School of Nursing Science</option>
                                    <option value="19">School of Integrated Innovative Technology</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-6">
                            <label for="classYearInput" class="form-label">Class year</label>
                            <input type="text" class="form-control custom-form-control" id="classYearInput" placeholder="year number">
                        </div>
                    </div>

                    <div class="mb-3">
                        <label for="phoneInput" class="form-label">Phone</label>
                        <input type="phone" class="form-control custom-form-control" id="phoneInput" placeholder="0XX XXX XXXX">
                    </div>

                    <div class="mb-3">
                        <label for="emailInput" class="form-label">Email</label>
                        <input type="email" class="form-control custom-form-control" id="emailInput" placeholder="xxxxxx@kmitl.ac.th">
                    </div>
                    
                    <div class="mb-3">
                        <label for="passwordInput" class="form-label">Password</label>
                        <input type="password" class="form-control custom-form-control" id="passwordInput" placeholder="your password">
                    </div>

                    <div class="mb-3">
                        <label for="confirmPasswordInput" class="form-label">Confirm password</label>
                        <input type="password" class="form-control custom-form-control" id="confirmPasswordInput" placeholder="confirm your password">
                    </div>

                    <div class="mb-3">
                        <label class="form-label">Social accounts</label>
                        <div id="social-links-container">
                            </div>
                        <button type="button" class="btn w-100 mt-2 custom-add-social-btn" id="addSocialLinkBtn">
                            <i class="fas fa-plus"></i> Add more social link
                        </button>
                    </div>

                    <div class="d-flex justify-content-end mb-3">
                        <span class="text-muted me-1">Already have an account?</span>
                        <a href="signin.html" class="text-decoration-none custom-link-text custom-sign-in-link">sign in</a>
                    </div>
                    
                    <button type="submit" class="btn w-100 custom-create-account-btn">
                        Create new account
                    </button>
                </form>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        const addSocialLinkBtn = document.getElementById('addSocialLinkBtn');
        const socialLinksContainer = document.getElementById('social-links-container');
        const profileForm = document.querySelector('form');

        // Add social link functionality
        addSocialLinkBtn.addEventListener('click', () => {
            if (socialLinksContainer.childElementCount < 5) {
                createSocialLinkGroup(true);
            } else {
                alert('You can add a maximum of 5 social links.');
                addSocialLinkBtn.disabled = true;
            }
        });
        
        // FORM SUBMISSION - CONNECTS TO PYTHON BACKEND
        profileForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            
            // Collect form data
            const formData = {
                name: document.getElementById('nameInput').value,
                faculty: document.getElementById('facultySelect').value,
                class_year: document.getElementById('classYearInput').value,
                phone: document.getElementById('phoneInput').value,
                email: document.getElementById('emailInput').value,
                password: document.getElementById('passwordInput').value,
                confirm_password: document.getElementById('confirmPasswordInput').value,
                social_links: Array.from(socialLinksContainer.querySelectorAll('.social-link-group')).map(group => {
                    const type = group.querySelector('select').value;
                    const link = group.querySelector('input').value;
                    return { type, link };
                }).filter(link => link.link.trim() !== '') // Remove empty links
            };

            // Send to Python backend
            try {
                const response = await fetch('http://localhost:8000/api/signup', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(formData)
                });

                const result = await response.json();
                
                if (response.ok) {
                    alert('Account created successfully!');
                    window.location.href = 'signin.html';
                } else {
                    alert('Error: ' + result.detail);
                }
            } catch (error) {
                console.error('Error:', error);
                alert('Failed to create account. Please check if backend is running.');
            }
        });

        // Social link functions (keep existing)
        function createSocialLinkGroup(removable = true) {
            const div = document.createElement('div');
            div.className = 'social-link-group d-flex align-items-start mb-3';
            
            div.innerHTML = `
                <div style="width: 150px; flex-shrink: 0;" class="me-2">
                    <select class="form-select custom-form-control">
                        <option value="Facebook">Facebook</option>
                        <option value="Instagram">Instagram</option>
                        <option value="LINE">LINE</option>
                        <option value="Twitter / X">Twitter / X</option>
                        <option value="Discord">Discord</option>
                        <option value="Other">Other</option>
                    </select>
                </div>
                <input type="text" class="form-control custom-form-control" placeholder="link to social profile">
                ${removable ? '<button type="button" class="btn btn-sm btn-danger ms-2" style="flex-shrink: 0; height: 44px; line-height: 1;">&times;</button>' : ''}
            `;
            
            socialLinksContainer.appendChild(div);

            if (removable) {
                const removeButton = div.querySelector('.btn-danger');
                removeButton.addEventListener('click', function() {
                    this.closest('.social-link-group').remove();
                    if (socialLinksContainer.childElementCount < 5) {
                        addSocialLinkBtn.disabled = false;
                    }
                });
            }
        }
        
        function resetSocialLinks() {
            socialLinksContainer.innerHTML = '';
            createSocialLinkGroup(false);
        }

        resetSocialLinks();
        });
    </script>
</script>
</body>
</html>